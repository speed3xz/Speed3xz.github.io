<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Audio - Speed3xz</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: #1a1a1a; color: white; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .container { background: #2d2d2d; padding: 30px; border-radius: 10px; max-width: 500px; width: 100%; }
        h1 { color: #ff6b6b; margin-bottom: 10px; text-align: center; }
        .subtitle { color: #ccc; margin-bottom: 20px; text-align: center; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #3d3d3d; border: 1px solid #555; border-radius: 5px; color: white; }
        button { width: 100%; padding: 12px; background: #ff6b6b; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px 0; }
        button:disabled { background: #666; cursor: not-allowed; }
        .status { margin: 15px 0; padding: 10px; border-radius: 5px; display: none; }
        .success { background: #2ecc71; color: white; display: block; }
        .error { background: #e74c3c; color: white; display: block; }
        .loading { background: #3498db; color: white; display: block; }
        .info { background: #34495e; padding: 15px; border-radius: 5px; margin-top: 20px; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽµ YouTube Audio</h1>
        <p class="subtitle">By Speed3xz - Usando MI API</p>
        
        <input type="text" id="urlInput" placeholder="https://youtube.com/watch?v=..." value="https://www.youtube.com/watch?v=dQw4w9WgXcQ">
        <button id="downloadBtn">Descargar Audio</button>
        
        <div id="status"></div>
        
        <div class="info">
            <strong>API:</strong> speed3xz.bot.nu/api/youtube/proxy.html<br>
            <strong>Status:</strong> <span id="apiStatus">Online</span>
        </div>
    </div>

    <script>
        class SimpleYouTubeAPI {
            constructor() {
                this.apiUrl = '/api/youtube/proxy.html';
                this.urlInput = document.getElementById('urlInput');
                this.downloadBtn = document.getElementById('downloadBtn');
                this.statusDiv = document.getElementById('status');
                this.apiStatus = document.getElementById('apiStatus');
                
                this.setupEvents();
            }
            
            setupEvents() {
                this.downloadBtn.addEventListener('click', () => this.downloadAudio());
                this.urlInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.downloadAudio();
                });
            }
            
            async downloadAudio() {
                const url = this.urlInput.value.trim();
                if (!url) return this.showStatus('Ingresa una URL de YouTube', 'error');
                
                const videoId = this.getVideoId(url);
                if (!videoId) return this.showStatus('URL de YouTube invÃ¡lida', 'error');
                
                this.setLoading(true);
                this.showStatus('Buscando audio...', 'loading');
                
                try {
                    const apiCall = `${this.apiUrl}?url=${encodeURIComponent(url)}`;
                    console.log('Llamando API:', apiCall);
                    
                    const response = await fetch(apiCall);
                    const text = await response.text();
                    console.log('Respuesta completa:', text);
                    
                    // Extraer JSON puro del texto
                    const jsonText = this.extractJSON(text);
                    console.log('JSON extraÃ­do:', jsonText);
                    
                    const data = JSON.parse(jsonText);
                    
                    if (data.status === 'success') {
                        this.showStatus(`âœ… Audio encontrado via ${data.source}`, 'success');
                        this.downloadFile(data.url, data.title);
                    } else {
                        this.showStatus(`âŒ ${data.error}`, 'error');
                    }
                    
                } catch (error) {
                    console.error('Error completo:', error);
                    this.showStatus(`âŒ Error: ${error.message}`, 'error');
                } finally {
                    this.setLoading(false);
                }
            }
            
            extractJSON(text) {
                // Intentar mÃ©todos diferentes para extraer JSON limpio
                
                // 1. Buscar entre { }
                const jsonMatch = text.match(/\{[\s\S]*\}/);
                if (jsonMatch) return jsonMatch[0];
                
                // 2. Si es JSON puro, devolver tal cual
                if (text.trim().startsWith('{')) return text;
                
                // 3. Si no se puede extraer, crear error
                throw new Error('No se pudo extraer JSON de la respuesta');
            }
            
            getVideoId(url) {
                const patterns = [
                    /youtube\.com\/watch\?v=([a-zA-Z0-9_-]{11})/,
                    /youtu\.be\/([a-zA-Z0-9_-]{11})/,
                    /youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/
                ];
                
                for (const pattern of patterns) {
                    const match = url.match(pattern);
                    if (match) return match[1];
                }
                return null;
            }
            
            downloadFile(url, filename) {
                const link = document.createElement('a');
                link.href = url;
                link.download = (filename || 'audio') + '.mp3';
                link.target = '_blank';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            setLoading(loading) {
                this.downloadBtn.disabled = loading;
                this.downloadBtn.textContent = loading ? 'Procesando...' : 'Descargar Audio';
            }
            
            showStatus(message, type) {
                this.statusDiv.textContent = message;
                this.statusDiv.className = type;
            }
        }
        
        // Iniciar cuando se carga la pÃ¡gina
        window.addEventListener('load', () => {
            new SimpleYouTubeAPI();
        });
    </script>
</body>
</html>
