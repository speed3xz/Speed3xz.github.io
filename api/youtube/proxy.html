<!DOCTYPE html>
<html>
<head>
    <title>YouTube API Proxy - Speed3xz</title>
    <style>
        body { 
            display: none !important; 
        }
    </style>
    <script>
        // YouTube API Proxy - By Speed3xz
        // Esta API funciona como proxy para múltiples fuentes de YouTube
        
        class YouTubeAPIProxy {
            constructor() {
                this.init();
            }

            async init() {
                try {
                    const result = await this.processRequest();
                    this.returnPureJSON(result);
                } catch (error) {
                    this.returnPureJSON({
                        status: 'error',
                        error: error.message
                    });
                }
            }

            async processRequest() {
                const urlParams = new URLSearchParams(window.location.search);
                const youtubeUrl = urlParams.get('url');
                
                if (!youtubeUrl) {
                    throw new Error('Missing YouTube URL parameter. Usage: ?url=YOUTUBE_URL');
                }

                const videoId = this.extractVideoId(youtubeUrl);
                if (!videoId) {
                    throw new Error('Invalid YouTube URL format');
                }

                return await this.getAudioFromSources(videoId);
            }

            async getAudioFromSources(videoId) {
                const apis = [
                    {
                        name: 'SkyAPI',
                        url: `https://api-sky.ultraplus.click/api/download/yt.php?url=https://youtu.be/${videoId}&format=audio`,
                        headers: { 
                            'Authorization': 'Bearer Russellxz',
                            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                        },
                        extractor: (data) => data?.data?.audio || data?.data?.video || data?.audio
                    },
                    {
                        name: 'RubyCore', 
                        url: `https://ruby-core.vercel.app/api/download/youtube/mp3?url=https://youtu.be/${videoId}`,
                        extractor: (data) => data?.url || data?.audioUrl
                    },
                    {
                        name: 'Adonix',
                        url: `https://api-adonix.ultraplus.click/download/ytmp3?url=https://youtu.be/${videoId}`,
                        extractor: (data) => data?.data?.url || data?.url
                    },
                    {
                        name: 'MayAPI',
                        url: `https://mayapi.ooguy.com/ytdl?url=https://youtu.be/${videoId}&type=mp3`,
                        extractor: (data) => data?.result?.url || data?.url
                    }
                ];

                // Probar todas las APIs en paralelo
                const promises = apis.map(async (api) => {
                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 8000);
                        
                        const response = await fetch(api.url, {
                            headers: api.headers,
                            signal: controller.signal
                        });
                        
                        clearTimeout(timeoutId);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        const audioUrl = api.extractor(data);
                        
                        if (audioUrl && this.isValidUrl(audioUrl)) {
                            return {
                                success: true,
                                source: api.name,
                                url: audioUrl,
                                title: data.title || data.data?.title || `Audio ${videoId}`,
                                videoId: videoId
                            };
                        } else {
                            throw new Error('No valid audio URL found');
                        }
                    } catch (error) {
                        return {
                            success: false,
                            source: api.name,
                            error: error.message
                        };
                    }
                });

                const results = await Promise.all(promises);
                const successful = results.find(r => r.success);
                
                if (successful) {
                    return {
                        status: 'success',
                        url: successful.url,
                        title: successful.title,
                        source: successful.source,
                        videoId: successful.videoId,
                        timestamp: new Date().toISOString(),
                        domain: 'speed3xz.bot.nu'
                    };
                } else {
                    const errors = results.map(r => `${r.source}: ${r.error}`).join(', ');
                    throw new Error(`All APIs failed: ${errors}`);
                }
            }

            extractVideoId(url) {
                const regex = /(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/|shorts\/))([a-zA-Z0-9_-]{11})/;
                const match = url.match(regex);
                return match ? match[1] : null;
            }

            isValidUrl(string) {
                try {
                    new URL(string);
                    return true;
                } catch (_) {
                    return false;
                }
            }

            returnPureJSON(data) {
                // Limpiar todo el documento y escribir solo JSON
                document.open();
                document.write(JSON.stringify(data, null, 2));
                document.close();
                
                // También establecer content-type via meta tag
                const meta = document.createElement('meta');
                meta.httpEquiv = 'Content-Type';
                meta.content = 'application/json; charset=utf-8';
                document.head.appendChild(meta);
            }
        }

        // Inicializar inmediatamente
        new YouTubeAPIProxy();
    </script>
</head>
<body>
    <!-- Este contenido será reemplazado por JSON puro -->
    <noscript>
        {"status": "error", "error": "JavaScript required for this API"}
    </noscript>
</body>
</html>
